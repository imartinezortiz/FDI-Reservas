<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.springframework.org/security/tags">
<head>
	<meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
	<link rel="stylesheet"
        href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"
        th:href="@{/webjars/bootstrap/3.3.5/css/bootstrap.min.css}"/>
    <link rel="stylesheet"
        href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0-3/css/font-awesome.min.css"
        th:href="@{/webjars/font-awesome/4.3.0-3/css/font-awesome.min.css}"/>
    <link rel="stylesheet"
        href="//cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.3.4/jquery.datetimepicker.css"
        th:href="@{/webjars/datetimepicker/2.3.4/jquery.datetimepicker.css}"/>
    <link rel="stylesheet"
        href="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.3.0/fullcalendar.min.css"
        th:href="@{/webjars/fullcalendar/2.3.0/fullcalendar.min.css}"/>
    <link rel="stylesheet" type="text/css" media="all" href="../../css/estilo.css" th:href="@{/css/estilo.css}"/>
    <!--<link rel="stylesheet" type="text/css" media="all" href="../../css/calendario.css" th:href="@{/css/calendario.css}"/>  -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'/>
	<title>UCM RESERVAS</title>
    <!-- JS -->
    <script 
        src="//code.jquery.com/jquery-2.1.4.min.js"
        th:src="@{/webjars/jquery/2.1.4/jquery.min.js}"></script>
    <script 
        src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"
        th:src="@{/webjars/jquery-ui/1.11.2/jquery-ui.min.js}"></script>
     <script 
        src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.min.js"
        th:src="@{/webjars/momentjs/2.9.0/min/moment.min.js}"></script>
    <script
        src="//cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.3.4/jquery.datetimepicker.js"
        th:src="@{/webjars/datetimepicker/2.3.4/jquery.datetimepicker.js}"></script>
    <script
        src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"
        th:src="@{/webjars/bootstrap/3.3.5/js/bootstrap.min.js}"></script>
    <script
        src="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.3.0/fullcalendar.min.js"
        th:src="@{/webjars/fullcalendar/2.3.0/fullcalendar.min.js}"></script>
     <script
        src="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.3.0/lang-all.js"
        th:src="@{/webjars/fullcalendar/2.3.0/lang-all.js}"></script>

	
	
    <script type="text/javascript">

        $(document).ready(function(){
            $('[data-toggle="tooltip"]').tooltip(); 
            
            var pathname = window.location.pathname;
            
            if(pathname.indexOf("edificio") >= 0){
            	$("#li_porespacios").addClass("active");
            	$("#demo").collapse();
            }
            else if(pathname.indexOf("fecha") >= 0){
            	$("#li_porfecha").addClass("active");
            	$("#demo").collapse();
            }
            else{
            	$("#li_misreservas").addClass("active");
            }
            

         $(function () {
        	 var logic = function(currentDateTime) {
        			this.setOptions({
        				minTime : '09:00',
        				maxTime : '21:00',
        				todayButton : true
        			});
        		};
        		
             $('*>#datetimepicker1').datetimepicker({
            		format : 'd/m/Y H:i',
         			step : 30,
         			minDate : '0',
         			onChangeDateTime : logic,
         			onShow : logic
             });
             
             $('*>#datetimepicker2').datetimepicker({
            		format : 'd/m/Y H:i',
         			step : 30,
         			minDate : '0',
         			onChangeDateTime : logic,
         			onShow : logic
         	 });
         });
     
       });
    </script>
</head>
<body>

	<div id="content">

        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <!-- Logotipo -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <div class="navbar-brand">
                    <a href="index.html"> <img class="img-circle" src="../../img/ucm-ws.png" th:src="@{/img/ucm-ws.png}" width="30" height="30"/> UCM Reservas</a>
                </div>
                
                
            </div>
            <!-- Top bar right side -->

            <ul class="nav navbar-right top-nav">
                <!-- Mensajes -->
                <!-- <li class="dropdown">
                    <a href="javascript;" class="dropdown-toggle" data-toggle="dropdown"><span class="badge">2</span> <i class="fa fa-envelope"></i> <i class="fa fa-angle-down"></i></a>
                    <ul class="dropdown-menu message-dropdown">
                        <li class="message-preview">
                            <a href="#">
                                <div class="media">
                                    <span class="pull-left">
                                        <img class="img-circle" src="http://placehold.it/50x50" alt=""/>
                                    </span>
                                    <div class="media-body">
                                        <h5 class="media-heading"><strong>Jose Vara</strong>
                                        </h5>
                                        <p class="small text-muted"><i class="fa fa-clock-o"></i> Hoy a las 14:32 hs</p>
                                        <p>Lorem ipsum dolor sit amet, consectetur...</p>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="message-preview">
                            <a href="#">
                                <div class="media">
                                    <span class="pull-left">
                                        <img class="img-circle" src="http://placehold.it/50x50" alt=""/>
                                    </span>
                                    <div class="media-body">
                                        <h5 class="media-heading"><strong>Laura Santos</strong>
                                        </h5>
                                        <p class="small text-muted"><i class="fa fa-clock-o"></i> Ayer a las 04:32 hs</p>
                                        <p>Lorem ipsum dolor sit amet, consectetur...</p>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="message-footer text-center">
                            <a href="#">Leer todos los mensajes</a>
                        </li>
                    </ul>
                </li> -->
                <!-- Notificaciones -->
                <li class="dropdown">
                    <a href="javascript.;" class="dropdown-toggle" data-toggle="dropdown"><span class="badge">3</span> <i class="fa fa-bell"></i> <i class="fa fa-angle-down"></i></a>
                    <ul class="dropdown-menu alert-dropdown">
                        <li>
                            <a href="#">Aula 9 <i class="fa fa-check-circle-o color-green" style="font-size:1.4em;"></i></a>
                        </li> 
                        <li>
                            <a href="#">Sala de Reuniones <i class="fa fa-check-circle-o color-green" style="font-size:1.4em;"></i></a>
                        </li>
                        <li>
                            <a href="#">Sala de Grados <i class="fa fa-times-circle-o color-red" style="font-size:1.4em;"></i></a>
                        </li>
                        <li class="divider"></li>
                        <li class="text-center">
                            <a href="#">Ver todas</a>
                        </li>
                    </ul>
                </li>
                <!-- Perfil -->
                <!--/*/ <th:block sec:authorize="isAuthenticated()"> /*/-->
                <li class="dropdown">
                    <a href="javascript.;" class="dropdown-toggle" data-toggle="dropdown" th:inline="text"><i class='fa fa-user' ></i> [[${user.username}]] <i class='fa fa-angle-down'></i></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="#"><i class="fa fa-fw fa-user"></i> Perfil</a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-fw fa-envelope"></i> Correo</a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-fw fa-gear"></i> Ajustes</a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <form action="#" th:action="@{/logout}" method="POST">                 
							<button id="btn-logout" type="submit"><i class="fa fa-fw fa-power-off"></i> Logout</button>
							<input type="hidden"
								th:name="${_csrf.parameterName}"
								th:value="${_csrf.token}"/>
						</form>
                        </li>
                    </ul>
                </li>
                <!--/*/ </th:block> /*/-->
            </ul>

            <!-- Left bar menu -->
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav side-nav">
                    <li id="li_misreservas">
                        <a th:href="@{/mis_reservas}"><i class="fa fa-book"></i> Mis Reservas</a>
                    </li>
                    <li>
                       <a href="javascript:;" data-toggle="collapse" data-target="#demo"><i class="fa fa-calendar-o"></i> Reservar <i class="fa fa-angle-down"></i></a>
                        <ul id="demo" class="collapse">
                            <li id="li_porespacios">
                                <a th:href="@{/edificios}"> Por espacio</a>
                            </li>
                            <li id="li_porfecha">
                                <a href="reservas_fecha" th:href="@{/reservas_fecha}">Por fecha</a>
                            </li>
                        </ul>
                    </li> 
                </ul>
            </div>
            
            <!-- /.navbar-collapse -->
        </nav>

        <div id="main-content">

            <div class="container-fluid" th:fragment="contenido">

<!-- Page Heading -->
<div class="row">
    <div class="col-md-12">
        <h1 class="page-header text-center">
            Lista <small>de reservas</small>
        </h1>
    </div>
</div>
<!-- /.row -->

<div class="row">
	<div class="col-md-8 col-md-offset-2">
        
        <div class="jumbotron text-center" th:if="${#lists.isEmpty(allReservations)}">
                <i class="fa fa-ban fa-5x"></i>
                <h4>¡Uups! Todavía no has hecho ninguna reserva.</h4>
           </div> 

            <div class="table-responsive" th:unless="${#lists.isEmpty(allReservations)}">
                <table class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <th>Asunto</th>
                            <th>Espacio</th>
                            <th>Desde</th>
                            <th>Hasta</th>
                            <th>Estado</th>
                            
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="r : ${allReservations}" th:attr="data-idReserva=${r.id}">
                            <td th:text="${r.asunto}">Recuperacion de clase</td>
                            <td th:text="${r.espacio.nombre_espacio}">Aula 9</td>
                            <td th:text="${#joda.format(r.fecha_ini, 'dd/MM/yyyy HH:mm')}">21/01/2016</td>
                            <td th:text="${#joda.format(r.fecha_fin, 'dd/MM/yyyy HH:mm')}">21/01/2016</td>
                            <td th:if="${r.estado}" class=" text-center"><span class="label label-success">Confirmada</span></td>
                            <td th:unless="${r.estado}" class=" text-center"><span class="label label-danger">Denegada</span></td>
                        </tr>     
                    </tbody>
                </table>
            </div> 
            <!-- /.table-responsive-->
        
    </div>
</div>
 <!-- /.row -->
 
 <div class="modal fade" id="modalEditarReserva" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Editar reserva</h4>
          </div>
          <div class="modal-body">
          		<form class="form-horizontal" role="form" action="#" th:action="@{/editar}" th:object="${Reserva}" method="put">             
				
				 <!-- Asunto --> 
                 <div class="form-group">
                     <label for="ejemplo_2" class="col-md-2 control-label">Asunto:</label>
                      <div class="col-md-10">
                         <input id="idAsunto" name="asunto" type="text" class="form-control" placeholder="Introduce un asunto"/>
                      </div>
                 </div>
                 
                 <!-- Fecha inicio --> 
                 <div class="form-group">
                     <label for="ejemplo_3" class="col-md-3 control-label">Desde:</label>
                     <div class="col-md-9">
		                <div class='input-group date' >
			               <input name="fecha_ini" id="datetimepicker1" type='text' class="form-control" />
			               <span class="input-group-addon">
			                   <span class="fa fa-calendar"></span>
			               </span>
			            </div>
                     </div>
                 </div>
                 
                 <!-- Fecha fin --> 
                 <div class="form-group">
                     <label for="ejemplo_3" class="col-md-3 control-label">Hasta:</label>
		             <div class="col-md-9">
		                 <div class='input-group date' >
			                <input name="fecha_fin" id="datetimepicker2" type='text' class="form-control" />
			                <span class="input-group-addon">
			                    <span class="fa fa-calendar"></span>
			                </span>
			             </div>
                      </div>
                 </div>
                 
                 <!-- Tipo de espacio 
                 <div class="col-md-4">
                   <div class="form-group">
                      <label for="ejemplo_1" class="col-md-3 control-label">Tipo:</label>
                     <div class="col-md-9">
                         <p class="form-control-static" >xxxx</p>                   
                     </div>
                   </div>
                 </div> --> 
                 
                 <!-- Espacios --> 
                
                   <div class="form-group">
                      <label for="ejemplo_1" class="col-md-2 control-label">Espacio:</label>
                     <div class="col-md-10">
                          <p id="nombre_espacio" class="form-control-static" >yyyy</p>                     
                     </div>
                   </div>
                 
 

                 <div class="row">
                     <div class="col-xs-6 col-md-6">
                      <button id="btn-eliminar" type="button" class="btn-rec red">ELIMINAR</button>
                     </div>
                     <div class="col-xs-6 col-md-6 text-right">
                      <button type="submit" class="btn-rec blue">GUARDAR </button>
                     </div>
                 </div>                
             </form>
                 
          </div>
        </div>
      </div>
    </div>
 
 <script>
 $(document).ready(function(){
	 var idReserva;
	 
	 $('tr').click(function(){
		 $('#modalEditarReserva').modal('show');
		 var asunto = $(this).find("td").eq(0).html();
		 var espacio = $(this).find("td").eq(1).html();
		 var f_ini = $(this).find("td").eq(2).html();
		 var f_fin = $(this).find("td").eq(3).html();
		 
		 $('#modalEditarReserva #idAsunto').attr("value",asunto);
		 $('#modalEditarReserva #datetimepicker1').attr("value",f_ini);
	  	 $('#modalEditarReserva #datetimepicker2').attr("value",f_fin);
	  	 $('#modalEditarReserva #nombre_espacio').text(espacio);
	  	
	  	 
	  	idReserva = $(this).attr("data-idReserva");
	  	 
	 });
	 
	 
	 $("#btn-eliminar").click(function(){
  		 
	  		 console.log('/reservas/reserva/' + idReserva);
	  		$.ajax({
				url: '/reservas/reserva/' + idReserva,
				type: 'DELETE',
				success : function(datos) {
					
					alert("Reserva eliminada");
				    
				},    
			    error : function(xhr, status) {
			        alert('Disculpe, existió un problema');
			    }
			});
	  		
	  	 });
	 
 });
 
 
 </script>
 
 </div>
 <!-- Fin fragment -->
   
            </div>
            <!-- /.container-fluid -->

        </div>
        <!-- /#main-content -->

    </div>
    <!-- /#content -->

</body>
</html>